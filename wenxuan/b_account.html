<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>账号设置</title>
    <link rel="stylesheet" href="font/iconfont.css">
    <link rel="stylesheet" href="./css/b_account.css">
    <link rel="stylesheet" href="./css/c-head.css">
    <link rel="stylesheet" href="./css/js_myWenxuan.css">
    <link rel="shortcut icon" href="https://pic.liesio.com/2020/09/16/e7c4e908c32e8.ico">
    <link rel="bookmark" href="https://pic.liesio.com/2020/09/16/e7c4e908c32e8.ico">
</head>

<body>
    <div class="c_layout">
        <header class="c_top">
            <!-- 顶部导航 -->
            <div class="w_top_w">
                <div class="c_top_n c_position" id="c_top_1">
                    <div class="c_top_nav c_content">
                        <ul class="c_link_left">
                            <li>欢迎光临文轩网！</li>
                            <li>
                                <a href="./b_login.html">请<span>&nbsp;&nbsp;登录</span></a>
                                <a href="./b_sign-up.html">免费注册</a>
                            </li>
                        </ul>
                        <ul class="c_link_right">
                            <li class="c_li_1">
                                <a href="./js_myWenxuan.html">
                                    <span>我的文轩</span>
                                    <i class="iconfont icon-jiantou"></i>
                                </a>
                                <div class="c_pop">
                                    <ul class="c_pop_item">
                                        <li class="c_item_list">
                                            <a href="./js_myWenxuan.html">我的订单</a>
                                        </li>
                                        <li class="c_item_list">
                                            <a href="./b_account.html">账号设置</a>
                                        </li>
                                        <!-- <li class="c_item_list">
                                            <a href="#">暂存款</a>
                                        </li>
                                        <li class="c_item_list">
                                            <a href="#">礼券</a>
                                        </li>
                                        <li class="c_item_list">
                                            <a href="#">购书卡</a>
                                        </li> -->
                                    </ul>
                                </div>
                            </li>
                            <li class="c_li_2">
                                <a href="./z_index.html">
                                    <span>企业采购</span>
                                </a>
                            </li>
                            <li class="c_li_3">
                                <a href="#">
                                    <span>客户服务</span>
                                    <i class="iconfont icon-jiantou"></i>
                                </a>
                                <div class="c_pop">
                                    <ul class="c_pop_item">
                                        <li class="c_item_list">
                                            <a href="./w_robat.html">在线客服</a>
                                        </li>
                                        <li class="c_item_list">
                                            <a href="./y_help.html">帮助中心</a>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            <li class="c-li_4">
                                <a href="#">
                                    <span>手机文轩</span>
                                    <i class="iconfont icon-jiantou"></i>
                                </a>
                                <div class="c_pop c_pop_s">
                                    <div class="c_pop_item">
                                        <img src="./img/m1.jpg" alt="">
                                        <a href="#">扫一扫&nbsp;&nbsp;文轩手机购物></a>
                                    </div>
                                    <div class="c_pop_item">
                                        <img src="./img/m2.png" alt="">
                                        <a href="#">电子书&nbsp;&nbsp;客户端></a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </header>
    </div>
    <div class="w_top_wrap">
        <div class="w_top_content">
            <div class="w_top_logo">
                <a href="./c_head.html">
                    <img src="https://static.winxuancdn.com/css/v2/images/logo.png" alt="">
                </a>
            </div>
            <div class="w_top_ul">
                <ul>
                    <li class="w_top_item"><a href="js_myWenxuan.html">我的文轩</a></li>
                    <li class="w_top_item"><a href="b_account.html">账号设置</a></li>
                    <li class="w_top_item"><a href="">管理收货地址</a></li>
                    <li class="w_top_item"><a href="">在线客服</a></li>
                </ul>
            </div>
            <!-- 搜索框 -->
            <div class="w_top_search">
                <form method="get" class="w_top_form" action="https://search.winxuan.com/search" name="searchForm">
                    <div class="w_top_search_wrap">
                        <img class=""
                            src="https://static.winxuancdn.com/cms/assets/images/winxuanhome/index/index-search-icon.png"
                            alt="">
                        <input class="w_top_input" type="text" autocomplete="off" name="keyword" placeholder=""
                            data-array="活着|雪国之劫|抖音营销|">
                        <button class="w_top_btn" type="submit"> 搜索 </button>
                    </div>
                </form>
            </div>
            <!-- 购物车 -->
            <div class="w_top_cart">
                <a href="#" target="_blank">
                    <div class="w_top_cart_wrap">
                        <b></b>
                        <label class="w_cart">购物车</label>
                        <span class="w_outline"></span>
                        <span class="w_outline"></span>
                        <span class="w_overlayout"></span>
                        <div class="w_cart_num"> 0 </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- mask -->
    <div class="b_mask">
        <div class="b_window">
            <div class="b_window_head">
                <span class="b_window_head_txt">修改登录密码</span>
                <span class="b_window_close">×</span>
            </div>
            <div class="b_window_con">
                <div class="b_window_item">
                    <div class="b_window_info">账号 :</div>
                    <div class="b_window_username">vip</div>
                </div>
                <div class="b_window_item">
                    <div class="b_window_info">原密码 :</div>
                    <input type="text" class="b_window_old" placeholder="请输入原密码">
                    <p class="b_psw_err"></p>
                </div>
                <div class="b_window_item">
                    <div class="b_window_info">新密码 :</div>
                    <input type="text" class="b_window_new" placeholder="请输入新密码">
                </div>
            </div>
            <div class="b_window_foot">
                确认修改
            </div>
        </div>
    </div>

    <div class="container">
        <div class="js_content">
            <!-- 左边列表内容部分 -->
            <div class="js_ctt_left">
                <div class="js_line"></div>
                <ul class="js_list">
                    <li class="js_list_title">账号设置</li>
                    <li class="js_list_item"><a href="./address.html">收货地址</a></li>
                    <li class="js_list_item"><a href="./b_account.html">账号设置</a></li>
                </ul>
                <div class="js_line"></div>
                <ul class="js_list">
                    <li class="js_list_title">资产中心</li>
                    <li class="js_list_item"><a href="./z_index.html">购书卡</a></li>
                </ul>
                <div class="js_line"></div>
                <ul class="js_list">
                    <li class="js_list_title">商品记录</li>
                    <li class="js_list_item"><a href="./z_collect.html">收藏的商品</a></li>
                </ul>
                
                <div class="js_line"></div>
                <ul class="js_list">
                    <li class="js_list_title">帮助中心</li>
                    <li class="js_list_item"><a href="./w_robat.html">在线客服</a></li>
                    <li class="js_list_item"><a href="./y_help.html">帮助中心</a></li>
                </ul>
                <div class="js_line"></div>
            </div>
            <!-- content -->
            <!-- 右边内容部分 -->
            <div class="js_ctt_right">
                <div class="b_account">
                    <div class="b_head_tag">
                        <div class="b_tag">
                            <span>账号设置</span>
                        </div>
                    </div>
                    <div class="b_content_wrapper">
                        <!-- 基础信息 -->
                        <div class="b_item">
                            <h5 class="b_item_title">基础信息</h5>
                            <div class="b_item_info">
                                <span class="b_item_name">登录名:</span>
                                <span class="b_item_user" id="w_getuser">vip</span>
                            </div>
                        </div>
                        <!-- 安全服务 -->
                        <div class="b_item b_safe">
                            <h5 class="b_item_title">安全服务</h5>
                            <div class="b_item_list">
                                <div class="b_safe_left">
                                    <div class="b_safe_icon">
                                        <i class="iconfont icon-mima"></i>
                                    </div>
                                    <div class="b_safe_con">
                                        <p class="b_safe_title">登录密码</p>
                                        <span class="b_safe_desc">建议您定期更改密码以及保证您的帐号安全</span>
                                    </div>
                                </div>
                                <button class="b_change-psw">修改登录密码</button>
                            </div>
                        </div>
                        <!-- 三方账号 -->
                        <div class="b_item b_authAccount">
                            <h5 class="b_item_title">三方账号</h5>
                            <div class="b_item_lists">
                                <img class="b_cover"
                                    src="https://static.winxuancdn.com/frontstatic/mobile/dist/img/logo.png">
                                <p class="b_item_lists_name">文轩网账号</p>
                                <p class="b_item_lists_username">vip</p>
                                <a href="b_login.html" class="b_item_link">退出登录</a>
                                <div class="b_item_tag">注册账号</div>
                            </div>
                            <div class="b_item_lists">
                                <i class="iconfont icon-weixin "></i>
                                <p class="b_item_lists_name">微信账号</p>
                                <p class="b_item_lists_username"></p>
                                <a href="b_login.html" class="b_item_bind">绑定</a>
                            </div>
                            <div class="b_item_lists">
                                <i class="iconfont icon-weibo-copy"></i>
                                <p class="b_item_lists_name">微博账号</p>
                                <p class="b_item_lists_username"></p>
                                <a href="b_login.html" class="b_item_bind">绑定</a>
                            </div>
                            <div class="b_item_lists">
                                <i class="iconfont icon-qq"></i>
                                <p class="b_item_lists_name">QQ账号</p>
                                <p class="b_item_lists_username"></p>
                                <a href="b_login.html" class="b_item_bind">绑定</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        const b_change_psw = document.querySelector('.b_change-psw')
        const b_mask = document.querySelector('.b_mask')
        const b_window = document.querySelector('.b_window')
        const b_window_close = document.querySelector('.b_window_close')
        const b_window_foot = document.querySelector('.b_window_foot')
        const b_window_old = document.querySelector('.b_window_old')
        const b_window_new = document.querySelector('.b_window_new')
        const b_window_username = document.querySelector('.b_window_username')
        const b_psw_err = document.querySelector('.b_psw_err')
        const w_getuser = document.getElementById('w_getuser')
        let admin = [];
        let password = [];
        let id = [];

        window.onload = function(){
                const b_admin=localStorage.getItem('admin')
                w_getuser.innerHTML = b_admin;
                b_window_username.innerHTML=b_admin;
            
        }



        //获取数据库内的用户
        fetch('http://localhost:3000/user').then(response => {
            return response.json()
        }).then(res => {
            for (let j = 0; j < res.data.length; j++) {
                admin.push(res.data[j].admin)
                password.push(res.data[j].password)
                id.push(res.data[j].id)
            }
            console.log(admin, password, id);
        }).catch(err => {
            console.log(err);
        })



        //修改密码被点击时
        b_change_psw.onclick = function () {

            b_mask.style.zIndex = '2';
            b_mask.style.opacity = '1'
            b_window.style.height = 'auto'
            b_window.style.transform = 'translateY(0)'
            b_window.style.transition = '0'
            b_mask.style.transition = '0'
        }

        //X被点击时
        b_window_close.onclick = function () {
            b_window.style.transform = 'translateY(-300px)'
            b_mask.style.opacity = '0'
            b_window.style.height = '0'
            b_mask.style.zIndex = '-2';
            b_window.style.transition = 'height .5s'
            b_mask.style.transition = 'opacity .5s'
            b_window_old.value = ''
            b_window_new.value = ''
        }


        b_window_old.oninput = function () {
            b_psw_err.innerHTML = ''
        }


        //点击确认修改时
        b_window_foot.onclick = function () {
            if (b_window_old.value == b_window_new.value) {
                b_psw_err.innerHTML = '新密码和原密码一致，请重新输入'
            } else {
                let index = admin.indexOf(b_window_username.innerHTML)
                if (password[index] == b_window_old.value) {
                    fetch('http://localhost:3000/updatePsw?id=' + id[index] + '&&psw=' + b_window_new.value).then(response => {
                        return response.json()
                    }).then(res => {
                        console.log(res);

                        localStorage.removeItem('admin')
                        alert(res.status)
                        window.location.href = 'b_login.html'
                    }).catch(err => {
                        console.log(err);
                    })

                } else {
                    b_psw_err.innerHTML = '原密码输入错误'
                }
            }


        }
    </script>
</body>

</html>